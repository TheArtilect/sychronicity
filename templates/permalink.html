{% extends "base.html" %}

{% block content %}
<div id="permalink">

    {% if edit_post %}
    <h2>Edit your blog</h2>
    <form method="post">
        <label><h3>Title</h3></label>
            <input type="text" name="title" value="{{post.title}}">

        <br>

        <h3>Posting</h3>
        <textarea name="change">{{ post.render_back() | safe }}</textarea>


        <br>
        <input type="submit" class="refresh">
    </form>


    {% else %}

    <div class='permalink-post col-md-12'>
        <div class="permalink-post-header">
            <h3 class="post-title">{{ post.title }}</h3>
            <h4>By {{ post.creator }}</h4>
            <p class="timestamp">{{post.created.strftime("Created: %b %d, %Y %I:%M %p ")}}</p>
        </div>

        <div class="post-content container-fluid text-justify">
            <p>{{ post.rendered_content() | safe }}</p>
        </div>

        <div class='container-fluid post-footer'>
            <div class="row">
                <div class="col-md-4">
                    <p class="timestamp">{{post.last_modified.strftime("Modified: %b %d, %Y %I:%M %p")}}</p>
                </div>
                <div class="col-md-1 col-md-offset-1">
                    <p id="post-likes">{{likes}} Likes</p>
                </div>
            </div>
        </div>

        <br>

            {% if user_already_liked %}

            <form method="post">
                <input type="submit" name="unlike" value="Unlike" class="refresh">
            </form>
            {% else %}
            <form method="post">
                <input type="submit" name="likes" value="Like" class="refresh">
            </form>
            {% endif %}

        <form method='post'>
            <input type='submit' name="edit" value="Edit" class="refresh">
        </form>

        <form method="post">
            <input type='submit' name='delete_post' value="Delete" class="refresh">
        </form>
        <br>
        <p class='error'>{{error}}</p>
    </div>  <!-- permalink post -->
    <br>
    <form method='post'>
        <h6>Post a comment below:</h6>
        <textarea name="comment" value=""></textarea>
        <br>
        <input type='submit' class='refresh'>
    </form>
    <br>

    {% endif %}

<!--- not working, not saving to db
    {% if edit_comment %}
        <form method="post">
            <textarea name="edit_comment_text">{{comment_obj.unrender_comment()}}</textarea>
            <input type="submit">
        </form>
    {% endif %}
-->

    {% for comment in comments %}

        <div class="comment">
            <h5 class="comment-header">{{comment.user}} said:</h5>
            <p class='comment-content'>{{comment.rendered_comment() | safe }}</p>
            <p>{{comment.created.strftime("%I:%M %p on %b %d, %Y")}}<p>
            <form method="post">
                <input type="hidden" name="comment_id" value="{{comment.key().id()}}">
                <input type="submit" name="delete_comment" value="Delete" class="refresh">
            </form>
        <!--
            <form method="post">
                <input type="hidden" name="edit_comment_id" value="{{comment.key().id()}}">
                <input type="submit" name='edit_comment' value="Edit">
            </form>
    -->
        </div>
        <hr>

    {% endfor %}
</div>


{% endblock %}
